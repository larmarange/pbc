<?php
// This script and data application were generated by AppGini 5.74
// Download AppGini for free from https://bigprof.com/appgini/download/

	/* Configuration */
	/*************************************/

		$pcConfig = array(
			'conventions' => array(   
				'porteur' => array(   
					'parent-table' => 'personnes',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'Conventions <span class="hidden child-label-conventions child-field-caption">(Porteur)</span>',
					'auto-close' => false,
					'table-icon' => 'resources/table_icons/035-legal-document.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Nom', 2 => 'Statut', 3 => 'Bailleur(s)', 4 => 'Porteur', 5 => 'D&#233;but', 6 => 'Fin', 7 => 'Dur&#233;e (mois)', 9 => 'Accord&#233; hors FG', 10 => 'Frais de Gestion', 11 => 'Total Accord&#233;', 12 => 'Vers&#233;', 13 => 'Reste &#224; Verser', 14 => 'Ouvert', 15 => 'Reste &#224; Ouvrir', 16 => 'R&#233;serv&#233;', 17 => 'Liquid&#233;', 18 => 'Utilis&#233; (R+L)', 19 => 'Disponible (O-U)', 20 => 'Reste &#224; Engager', 21 => 'U/O (%)', 22 => 'U/V (%)', 23 => 'U/A (%, hors FG)', 24 => 'Budget non ventil&#233;', 25 => 'D&#233;penses non ventil&#233;es'),
					'display-field-names' => array(1 => 'nom', 2 => 'statut', 3 => 'bailleur', 4 => 'porteur', 5 => 'date_debut', 6 => 'date_fin', 7 => 'duree', 9 => 'accorde_hfg', 10 => 'frais_gestion', 11 => 'accorde', 12 => 'verse', 13 => 'reste_verser', 14 => 'ouvert', 15 => 'reste_ouvrir', 16 => 'reserve', 17 => 'liquide', 18 => 'utilise', 19 => 'disponible', 20 => 'reste_engager', 21 => 'prop_uo', 22 => 'prop_uv', 23 => 'prop_ua', 24 => 'budget_nv', 25 => 'depenses_nv'),
					'sortable-fields' => array(0 => '`conventions`.`id`', 1 => 2, 2 => 3, 3 => 4, 4 => '`personnes1`.`nom`', 5 => '`conventions`.`date_debut`', 6 => '`conventions`.`date_fin`', 7 => '`conventions`.`duree`', 8 => 9, 9 => '`conventions`.`accorde_hfg`', 10 => '`conventions`.`frais_gestion`', 11 => '`conventions`.`accorde`', 12 => '`conventions`.`verse`', 13 => '`conventions`.`reste_verser`', 14 => '`conventions`.`ouvert`', 15 => '`conventions`.`reste_ouvrir`', 16 => '`conventions`.`reserve`', 17 => '`conventions`.`liquide`', 18 => '`conventions`.`utilise`', 19 => '`conventions`.`disponible`', 20 => '`conventions`.`reste_engager`', 21 => '`conventions`.`prop_uo`', 22 => '`conventions`.`prop_uv`', 23 => '`conventions`.`prop_ua`', 24 => '`conventions`.`budget_nv`', 25 => '`conventions`.`depenses_nv`'),
					'records-per-page' => 50,
					'default-sort-by' => 6,
					'default-sort-direction' => 'desc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-conventions',
					'template-printable' => 'children-conventions-printable',
					'query' => "SELECT `conventions`.`id` as 'id', `conventions`.`nom` as 'nom', `conventions`.`statut` as 'statut', `conventions`.`bailleur` as 'bailleur', IF(    CHAR_LENGTH(`personnes1`.`nom`), CONCAT_WS('',   `personnes1`.`nom`), '') as 'porteur', if(`conventions`.`date_debut`,date_format(`conventions`.`date_debut`,'%d/%m/%Y'),'') as 'date_debut', if(`conventions`.`date_fin`,date_format(`conventions`.`date_fin`,'%d/%m/%Y'),'') as 'date_fin', `conventions`.`duree` as 'duree', `conventions`.`notes` as 'notes', CONCAT('<span style=''color: ', IF(`conventions`.`accorde_hfg` < 0, 'red', 'black'), ';''>', FORMAT(`conventions`.`accorde_hfg`, 2, 'ru_RU'), '</span>') as 'accorde_hfg', CONCAT('<span style=''color: ', IF(`conventions`.`frais_gestion` < 0, 'red', 'black'), ';''>', FORMAT(`conventions`.`frais_gestion`, 2, 'ru_RU'), '</span>') as 'frais_gestion', CONCAT('<span style=''color: ', IF(`conventions`.`accorde` < 0, 'red', 'black'), ';''>', FORMAT(`conventions`.`accorde`, 2, 'ru_RU'), '</span>') as 'accorde', CONCAT('<span style=''color: ', IF(`conventions`.`verse` < 0, 'red', 'black'), ';''>', FORMAT(`conventions`.`verse`, 2, 'ru_RU'), '</span>') as 'verse', CONCAT('<span style=''color: ', IF(`conventions`.`reste_verser` < 0, 'red', 'black'), ';''>', FORMAT(`conventions`.`reste_verser`, 2, 'ru_RU'), '</span>') as 'reste_verser', CONCAT('<span style=''color: ', IF(`conventions`.`ouvert` < 0, 'red', 'black'), ';''>', FORMAT(`conventions`.`ouvert`, 2, 'ru_RU'), '</span>') as 'ouvert', CONCAT('<span style=''color: ', IF(`conventions`.`reste_ouvrir` < 0, 'red', 'black'), ';''>', FORMAT(`conventions`.`reste_ouvrir`, 2, 'ru_RU'), '</span>') as 'reste_ouvrir', CONCAT('<span style=''color: ', IF(`conventions`.`reserve` < 0, 'red', 'black'), ';''>', FORMAT(`conventions`.`reserve`, 2, 'ru_RU'), '</span>') as 'reserve', CONCAT('<span style=''color: ', IF(`conventions`.`liquide` < 0, 'red', 'black'), ';''>', FORMAT(`conventions`.`liquide`, 2, 'ru_RU'), '</span>') as 'liquide', CONCAT('<span style=''color: ', IF(`conventions`.`utilise` < 0, 'red', 'black'), ';''>', FORMAT(`conventions`.`utilise`, 2, 'ru_RU'), '</span>') as 'utilise', CONCAT('<span style=''color: ', IF(`conventions`.`disponible` < 0, 'red', 'black'), ';''>', FORMAT(`conventions`.`disponible`, 2, 'ru_RU'), '</span>') as 'disponible', CONCAT('<span style=''color: ', IF(`conventions`.`reste_engager` < 0, 'red', 'black'), ';''>', FORMAT(`conventions`.`reste_engager`, 2, 'ru_RU'), '</span>') as 'reste_engager', CONCAT('<span style=''color: ', IF(`conventions`.`prop_uo` > 100, 'red', 'black'), ';''>', FORMAT(`conventions`.`prop_uo`, 0, 'ru_RU'), '%</span>') as 'prop_uo', CONCAT('<span style=''color: ', IF(`conventions`.`prop_uv` > 100, 'red', 'black'), ';''>', FORMAT(`conventions`.`prop_uv`, 0, 'ru_RU'), '%</span>') as 'prop_uv', CONCAT('<span style=''color: ', IF(`conventions`.`prop_ua` > 100, 'red', 'black'), ';''>', FORMAT(`conventions`.`prop_ua`, 0, 'ru_RU'), '%</span>') as 'prop_ua', CONCAT('<span style=''color: ', IF(`conventions`.`budget_nv` < 0, 'red', 'black'), ';''>', FORMAT(`conventions`.`budget_nv`, 2, 'ru_RU'), '</span>') as 'budget_nv', CONCAT('<span style=''color: ', IF(`conventions`.`depenses_nv` < 0, 'red', 'black'), ';''>', FORMAT(`conventions`.`depenses_nv`, 2, 'ru_RU'), '</span>') as 'depenses_nv' FROM `conventions` LEFT JOIN `personnes` as personnes1 ON `personnes1`.`id`=`conventions`.`porteur` "
				)
			),
			'budgets' => array(   
				'convention' => array(   
					'parent-table' => 'conventions',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'Lignes budg&#233;taires <span class="hidden child-label-budgets child-field-caption">(Convention)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/006-business.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Convention', 2 => 'Type', 3 => 'Accord&#233;', 4 => 'Vers&#233;', 5 => 'Reste &#224; Verser', 6 => 'Ouvert', 7 => 'Reste &#224; Ouvrir', 8 => 'Reserv&#233;', 9 => 'Liquid&#233;', 10 => 'Utilis&#233;', 11 => 'Disponible', 12 => 'Reste &#224; Engager', 13 => 'U/O (%)', 14 => 'U/V (%)', 15 => 'U/A (%)'),
					'display-field-names' => array(1 => 'convention', 2 => 'type', 3 => 'accorde', 4 => 'verse', 5 => 'reste_verser', 6 => 'ouvert', 7 => 'reste_ouvrir', 8 => 'reserve', 9 => 'liquide', 10 => 'utilise', 11 => 'disponible', 12 => 'reste_engager', 13 => 'prop_uo', 14 => 'prop_uv', 15 => 'prop_ua'),
					'sortable-fields' => array(0 => '`budgets`.`id`', 1 => '`conventions1`.`nom`', 2 => 3, 3 => '`budgets`.`accorde`', 4 => '`budgets`.`verse`', 5 => '`budgets`.`reste_verser`', 6 => '`budgets`.`ouvert`', 7 => '`budgets`.`reste_ouvrir`', 8 => '`budgets`.`reserve`', 9 => '`budgets`.`liquide`', 10 => '`budgets`.`utilise`', 11 => '`budgets`.`disponible`', 12 => '`budgets`.`reste_engager`', 13 => '`budgets`.`prop_uo`', 14 => '`budgets`.`prop_uv`', 15 => '`budgets`.`prop_ua`'),
					'records-per-page' => 50,
					'default-sort-by' => 2,
					'default-sort-direction' => 'asc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-budgets',
					'template-printable' => 'children-budgets-printable',
					'query' => "SELECT `budgets`.`id` as 'id', IF(    CHAR_LENGTH(`conventions1`.`nom`), CONCAT_WS('',   `conventions1`.`nom`), '') as 'convention', IF(    CHAR_LENGTH(`types_ligne1`.`gestionnaire`) || CHAR_LENGTH(`types_ligne1`.`type`), CONCAT_WS('',   `types_ligne1`.`gestionnaire`, ' - ', `types_ligne1`.`type`), '') as 'type', CONCAT('<span style=''color: ', IF(`budgets`.`accorde` < 0, 'red', 'black'), ';''>', FORMAT(`budgets`.`accorde`, 2, 'ru_RU'), '</span>') as 'accorde', CONCAT('<span style=''color: ', IF(`budgets`.`verse` < 0, 'red', 'black'), ';''>', FORMAT(`budgets`.`verse`, 2, 'ru_RU'), '</span>') as 'verse', CONCAT('<span style=''color: ', IF(`budgets`.`reste_verser` < 0, 'red', 'black'), ';''>', FORMAT(`budgets`.`reste_verser`, 2, 'ru_RU'), '</span>') as 'reste_verser', CONCAT('<span style=''color: ', IF(`budgets`.`ouvert` < 0, 'red', 'black'), ';''>', FORMAT(`budgets`.`ouvert`, 2, 'ru_RU'), '</span>') as 'ouvert', CONCAT('<span style=''color: ', IF(`budgets`.`reste_ouvrir` < 0, 'red', 'black'), ';''>', FORMAT(`budgets`.`reste_ouvrir`, 2, 'ru_RU'), '</span>') as 'reste_ouvrir', CONCAT('<span style=''color: ', IF(`budgets`.`reserve` < 0, 'red', 'black'), ';''>', FORMAT(`budgets`.`reserve`, 2, 'ru_RU'), '</span>') as 'reserve', CONCAT('<span style=''color: ', IF(`budgets`.`liquide` < 0, 'red', 'black'), ';''>', FORMAT(`budgets`.`liquide`, 2, 'ru_RU'), '</span>') as 'liquide', CONCAT('<span style=''color: ', IF(`budgets`.`utilise` < 0, 'red', 'black'), ';''>', FORMAT(`budgets`.`utilise`, 2, 'ru_RU'), '</span>') as 'utilise', CONCAT('<span style=''color: ', IF(`budgets`.`disponible` < 0, 'red', 'black'), ';''>', FORMAT(`budgets`.`disponible`, 2, 'ru_RU'), '</span>') as 'disponible', CONCAT('<span style=''color: ', IF(`budgets`.`reste_engager` < 0, 'red', 'black'), ';''>', FORMAT(`budgets`.`reste_engager`, 2, 'ru_RU'), '</span>') as 'reste_engager', CONCAT('<span style=''color: ', IF(`budgets`.`prop_uo` > 100, 'red', 'black'), ';''>', FORMAT(`budgets`.`prop_uo`, 0, 'ru_RU'), '%</span>') as 'prop_uo', CONCAT('<span style=''color: ', IF(`budgets`.`prop_uv` > 100, 'red', 'black'), ';''>', FORMAT(`budgets`.`prop_uv`, 0, 'ru_RU'), '%</span>') as 'prop_uv', CONCAT('<span style=''color: ', IF(`budgets`.`prop_ua` > 100, 'red', 'black'), ';''>', FORMAT(`budgets`.`prop_ua`, 0, 'ru_RU'), '%</span>') as 'prop_ua' FROM `budgets` LEFT JOIN `conventions` as conventions1 ON `conventions1`.`id`=`budgets`.`convention` LEFT JOIN `types_ligne` as types_ligne1 ON `types_ligne1`.`id`=`budgets`.`type` "
				)
			),
			'versements' => array(   
				'convention' => array(   
					'parent-table' => 'conventions',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'Versements (bailleur) <span class="hidden child-label-versements child-field-caption">(Convention)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/009-cash.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Convention', 2 => 'Ligne Budg&#233;taire', 3 => 'Date', 4 => 'Intitul&#233;', 5 => 'Montant', 6 => 'Notes'),
					'display-field-names' => array(1 => 'convention', 2 => 'ligne_budgetaire', 3 => 'date', 4 => 'intitule', 5 => 'montant', 6 => 'notes'),
					'sortable-fields' => array(0 => '`versements`.`id`', 1 => '`conventions1`.`nom`', 2 => 3, 3 => '`versements`.`date`', 4 => 5, 5 => '`versements`.`montant`', 6 => 7),
					'records-per-page' => 50,
					'default-sort-by' => 3,
					'default-sort-direction' => 'desc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-versements',
					'template-printable' => 'children-versements-printable',
					'query' => "SELECT `versements`.`id` as 'id', IF(    CHAR_LENGTH(`conventions1`.`nom`), CONCAT_WS('',   `conventions1`.`nom`), '') as 'convention', IF(    CHAR_LENGTH(`types_ligne1`.`gestionnaire`) || CHAR_LENGTH(`types_ligne1`.`type`), CONCAT_WS('',   `types_ligne1`.`gestionnaire`, ' - ', `types_ligne1`.`type`), '') as 'ligne_budgetaire', if(`versements`.`date`,date_format(`versements`.`date`,'%d/%m/%Y'),'') as 'date', `versements`.`intitule` as 'intitule', CONCAT('<span style=''color: ', IF(`versements`.`montant` < 0, 'red', 'black'), ';''>', FORMAT(`versements`.`montant`, 2, 'ru_RU'), '</span>') as 'montant', if(CHAR_LENGTH(`versements`.`notes`)>80, concat(left(`versements`.`notes`,80),' ...'), `versements`.`notes`) as 'notes' FROM `versements` LEFT JOIN `conventions` as conventions1 ON `conventions1`.`id`=`versements`.`convention` LEFT JOIN `budgets` as budgets1 ON `budgets1`.`id`=`versements`.`ligne_budgetaire` LEFT JOIN `types_ligne` as types_ligne1 ON `types_ligne1`.`id`=`budgets1`.`type` "
				),
				'ligne_budgetaire' => array(   
					'parent-table' => 'budgets',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'Versements (bailleur) <span class="hidden child-label-versements child-field-caption">(Ligne Budg&#233;taire)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/009-cash.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Convention', 2 => 'Ligne Budg&#233;taire', 3 => 'Date', 4 => 'Intitul&#233;', 5 => 'Montant', 6 => 'Notes'),
					'display-field-names' => array(1 => 'convention', 2 => 'ligne_budgetaire', 3 => 'date', 4 => 'intitule', 5 => 'montant', 6 => 'notes'),
					'sortable-fields' => array(0 => '`versements`.`id`', 1 => '`conventions1`.`nom`', 2 => 3, 3 => '`versements`.`date`', 4 => 5, 5 => '`versements`.`montant`', 6 => 7),
					'records-per-page' => 50,
					'default-sort-by' => 3,
					'default-sort-direction' => 'desc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-versements',
					'template-printable' => 'children-versements-printable',
					'query' => "SELECT `versements`.`id` as 'id', IF(    CHAR_LENGTH(`conventions1`.`nom`), CONCAT_WS('',   `conventions1`.`nom`), '') as 'convention', IF(    CHAR_LENGTH(`types_ligne1`.`gestionnaire`) || CHAR_LENGTH(`types_ligne1`.`type`), CONCAT_WS('',   `types_ligne1`.`gestionnaire`, ' - ', `types_ligne1`.`type`), '') as 'ligne_budgetaire', if(`versements`.`date`,date_format(`versements`.`date`,'%d/%m/%Y'),'') as 'date', `versements`.`intitule` as 'intitule', CONCAT('<span style=''color: ', IF(`versements`.`montant` < 0, 'red', 'black'), ';''>', FORMAT(`versements`.`montant`, 2, 'ru_RU'), '</span>') as 'montant', if(CHAR_LENGTH(`versements`.`notes`)>80, concat(left(`versements`.`notes`,80),' ...'), `versements`.`notes`) as 'notes' FROM `versements` LEFT JOIN `conventions` as conventions1 ON `conventions1`.`id`=`versements`.`convention` LEFT JOIN `budgets` as budgets1 ON `budgets1`.`id`=`versements`.`ligne_budgetaire` LEFT JOIN `types_ligne` as types_ligne1 ON `types_ligne1`.`id`=`budgets1`.`type` "
				)
			),
			'lignes_credits' => array(   
				'convention' => array(   
					'parent-table' => 'conventions',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'Lignes de Cr&#233;dits <span class="hidden child-label-lignes_credits child-field-caption">(Convention)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/044-prince2.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Convention', 2 => 'Ligne Budg&#233;taire', 3 => 'Intitul&#233; / CFI', 4 => 'Notes', 5 => 'Ouvert', 6 => 'Reserv&#233;', 7 => 'Liquid&#233;', 8 => 'Utilis&#233;', 9 => 'Disponible', 10 => 'U/O (%)'),
					'display-field-names' => array(1 => 'convention', 2 => 'ligne_budgetaire', 3 => 'intitule', 4 => 'notes', 5 => 'ouvert', 6 => 'reserve', 7 => 'liquide', 8 => 'utilise', 9 => 'disponible', 10 => 'prop_uo'),
					'sortable-fields' => array(0 => '`lignes_credits`.`id`', 1 => '`conventions1`.`nom`', 2 => 3, 3 => 4, 4 => 5, 5 => '`lignes_credits`.`ouvert`', 6 => '`lignes_credits`.`reserve`', 7 => '`lignes_credits`.`liquide`', 8 => '`lignes_credits`.`utilise`', 9 => '`lignes_credits`.`disponible`', 10 => '`lignes_credits`.`prop_uo`'),
					'records-per-page' => 50,
					'default-sort-by' => false,
					'default-sort-direction' => 'asc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-lignes_credits',
					'template-printable' => 'children-lignes_credits-printable',
					'query' => "SELECT `lignes_credits`.`id` as 'id', IF(    CHAR_LENGTH(`conventions1`.`nom`), CONCAT_WS('',   `conventions1`.`nom`), '') as 'convention', IF(    CHAR_LENGTH(`types_ligne1`.`gestionnaire`) || CHAR_LENGTH(`types_ligne1`.`type`), CONCAT_WS('',   `types_ligne1`.`gestionnaire`, ' - ', `types_ligne1`.`type`), '') as 'ligne_budgetaire', `lignes_credits`.`intitule` as 'intitule', if(CHAR_LENGTH(`lignes_credits`.`notes`)>80, concat(left(`lignes_credits`.`notes`,80),' ...'), `lignes_credits`.`notes`) as 'notes', CONCAT('<span style=''color: ', IF(`lignes_credits`.`ouvert` < 0, 'red', 'black'), ';''>', FORMAT(`lignes_credits`.`ouvert`, 2, 'ru_RU'), '</span>') as 'ouvert', CONCAT('<span style=''color: ', IF(`lignes_credits`.`reserve` < 0, 'red', 'black'), ';''>', FORMAT(`lignes_credits`.`reserve`, 2, 'ru_RU'), '</span>') as 'reserve', CONCAT('<span style=''color: ', IF(`lignes_credits`.`liquide` < 0, 'red', 'black'), ';''>', FORMAT(`lignes_credits`.`liquide`, 2, 'ru_RU'), '</span>') as 'liquide', CONCAT('<span style=''color: ', IF(`lignes_credits`.`utilise` < 0, 'red', 'black'), ';''>', FORMAT(`lignes_credits`.`utilise`, 2, 'ru_RU'), '</span>') as 'utilise', CONCAT('<span style=''color: ', IF(`lignes_credits`.`disponible` < 0, 'red', 'black'), ';''>', FORMAT(`lignes_credits`.`disponible`, 2, 'ru_RU'), '</span>') as 'disponible', CONCAT('<span style=''color: ', IF(`lignes_credits`.`prop_uo` > 100, 'red', 'black'), ';''>', FORMAT(`lignes_credits`.`prop_uo`, 0, 'ru_RU'), '%</span>') as 'prop_uo' FROM `lignes_credits` LEFT JOIN `conventions` as conventions1 ON `conventions1`.`id`=`lignes_credits`.`convention` LEFT JOIN `budgets` as budgets1 ON `budgets1`.`id`=`lignes_credits`.`ligne_budgetaire` LEFT JOIN `types_ligne` as types_ligne1 ON `types_ligne1`.`id`=`budgets1`.`type` "
				),
				'ligne_budgetaire' => array(   
					'parent-table' => 'budgets',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'Lignes de Cr&#233;dits <span class="hidden child-label-lignes_credits child-field-caption">(Ligne Budg&#233;taire)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/044-prince2.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Convention', 2 => 'Ligne Budg&#233;taire', 3 => 'Intitul&#233; / CFI', 4 => 'Notes', 5 => 'Ouvert', 6 => 'Reserv&#233;', 7 => 'Liquid&#233;', 8 => 'Utilis&#233;', 9 => 'Disponible', 10 => 'U/O (%)'),
					'display-field-names' => array(1 => 'convention', 2 => 'ligne_budgetaire', 3 => 'intitule', 4 => 'notes', 5 => 'ouvert', 6 => 'reserve', 7 => 'liquide', 8 => 'utilise', 9 => 'disponible', 10 => 'prop_uo'),
					'sortable-fields' => array(0 => '`lignes_credits`.`id`', 1 => '`conventions1`.`nom`', 2 => 3, 3 => 4, 4 => 5, 5 => '`lignes_credits`.`ouvert`', 6 => '`lignes_credits`.`reserve`', 7 => '`lignes_credits`.`liquide`', 8 => '`lignes_credits`.`utilise`', 9 => '`lignes_credits`.`disponible`', 10 => '`lignes_credits`.`prop_uo`'),
					'records-per-page' => 50,
					'default-sort-by' => false,
					'default-sort-direction' => 'asc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-lignes_credits',
					'template-printable' => 'children-lignes_credits-printable',
					'query' => "SELECT `lignes_credits`.`id` as 'id', IF(    CHAR_LENGTH(`conventions1`.`nom`), CONCAT_WS('',   `conventions1`.`nom`), '') as 'convention', IF(    CHAR_LENGTH(`types_ligne1`.`gestionnaire`) || CHAR_LENGTH(`types_ligne1`.`type`), CONCAT_WS('',   `types_ligne1`.`gestionnaire`, ' - ', `types_ligne1`.`type`), '') as 'ligne_budgetaire', `lignes_credits`.`intitule` as 'intitule', if(CHAR_LENGTH(`lignes_credits`.`notes`)>80, concat(left(`lignes_credits`.`notes`,80),' ...'), `lignes_credits`.`notes`) as 'notes', CONCAT('<span style=''color: ', IF(`lignes_credits`.`ouvert` < 0, 'red', 'black'), ';''>', FORMAT(`lignes_credits`.`ouvert`, 2, 'ru_RU'), '</span>') as 'ouvert', CONCAT('<span style=''color: ', IF(`lignes_credits`.`reserve` < 0, 'red', 'black'), ';''>', FORMAT(`lignes_credits`.`reserve`, 2, 'ru_RU'), '</span>') as 'reserve', CONCAT('<span style=''color: ', IF(`lignes_credits`.`liquide` < 0, 'red', 'black'), ';''>', FORMAT(`lignes_credits`.`liquide`, 2, 'ru_RU'), '</span>') as 'liquide', CONCAT('<span style=''color: ', IF(`lignes_credits`.`utilise` < 0, 'red', 'black'), ';''>', FORMAT(`lignes_credits`.`utilise`, 2, 'ru_RU'), '</span>') as 'utilise', CONCAT('<span style=''color: ', IF(`lignes_credits`.`disponible` < 0, 'red', 'black'), ';''>', FORMAT(`lignes_credits`.`disponible`, 2, 'ru_RU'), '</span>') as 'disponible', CONCAT('<span style=''color: ', IF(`lignes_credits`.`prop_uo` > 100, 'red', 'black'), ';''>', FORMAT(`lignes_credits`.`prop_uo`, 0, 'ru_RU'), '%</span>') as 'prop_uo' FROM `lignes_credits` LEFT JOIN `conventions` as conventions1 ON `conventions1`.`id`=`lignes_credits`.`convention` LEFT JOIN `budgets` as budgets1 ON `budgets1`.`id`=`lignes_credits`.`ligne_budgetaire` LEFT JOIN `types_ligne` as types_ligne1 ON `types_ligne1`.`id`=`budgets1`.`type` "
				)
			),
			'credits' => array(   
				'convention' => array(   
					'parent-table' => 'conventions',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'Cr&#233;dits (ouverture) <span class="hidden child-label-credits child-field-caption">(Convention)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/051-revenue.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Convention', 2 => 'Ligne Budg&#233;taire', 3 => 'Ligne de cr&#233;dit / CFI', 4 => 'Date', 5 => 'Intitul&#233;', 6 => 'Montant', 7 => 'Notes'),
					'display-field-names' => array(1 => 'convention', 2 => 'ligne_budgetaire', 3 => 'ligne_credit', 4 => 'date', 5 => 'intitule', 6 => 'montant', 7 => 'notes'),
					'sortable-fields' => array(0 => '`credits`.`id`', 1 => '`conventions1`.`nom`', 2 => 3, 3 => '`lignes_credits1`.`intitule`', 4 => '`credits`.`date`', 5 => 6, 6 => '`credits`.`montant`', 7 => 8),
					'records-per-page' => 50,
					'default-sort-by' => 4,
					'default-sort-direction' => 'desc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-credits',
					'template-printable' => 'children-credits-printable',
					'query' => "SELECT `credits`.`id` as 'id', IF(    CHAR_LENGTH(`conventions1`.`nom`), CONCAT_WS('',   `conventions1`.`nom`), '') as 'convention', IF(    CHAR_LENGTH(`types_ligne1`.`gestionnaire`) || CHAR_LENGTH(`types_ligne1`.`type`), CONCAT_WS('',   `types_ligne1`.`gestionnaire`, ' - ', `types_ligne1`.`type`), '') as 'ligne_budgetaire', IF(    CHAR_LENGTH(`lignes_credits1`.`intitule`), CONCAT_WS('',   `lignes_credits1`.`intitule`), '') as 'ligne_credit', if(`credits`.`date`,date_format(`credits`.`date`,'%d/%m/%Y'),'') as 'date', `credits`.`intitule` as 'intitule', CONCAT('<span style=''color: ', IF(`credits`.`montant` < 0, 'red', 'black'), ';''>', FORMAT(`credits`.`montant`, 2, 'ru_RU'), '</span>') as 'montant', if(CHAR_LENGTH(`credits`.`notes`)>80, concat(left(`credits`.`notes`,80),' ...'), `credits`.`notes`) as 'notes' FROM `credits` LEFT JOIN `conventions` as conventions1 ON `conventions1`.`id`=`credits`.`convention` LEFT JOIN `budgets` as budgets1 ON `budgets1`.`id`=`credits`.`ligne_budgetaire` LEFT JOIN `types_ligne` as types_ligne1 ON `types_ligne1`.`id`=`budgets1`.`type` LEFT JOIN `lignes_credits` as lignes_credits1 ON `lignes_credits1`.`id`=`credits`.`ligne_credit` "
				),
				'ligne_budgetaire' => array(   
					'parent-table' => 'budgets',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'Cr&#233;dits (ouverture) <span class="hidden child-label-credits child-field-caption">(Ligne Budg&#233;taire)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/051-revenue.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Convention', 2 => 'Ligne Budg&#233;taire', 3 => 'Ligne de cr&#233;dit / CFI', 4 => 'Date', 5 => 'Intitul&#233;', 6 => 'Montant', 7 => 'Notes'),
					'display-field-names' => array(1 => 'convention', 2 => 'ligne_budgetaire', 3 => 'ligne_credit', 4 => 'date', 5 => 'intitule', 6 => 'montant', 7 => 'notes'),
					'sortable-fields' => array(0 => '`credits`.`id`', 1 => '`conventions1`.`nom`', 2 => 3, 3 => '`lignes_credits1`.`intitule`', 4 => '`credits`.`date`', 5 => 6, 6 => '`credits`.`montant`', 7 => 8),
					'records-per-page' => 50,
					'default-sort-by' => 4,
					'default-sort-direction' => 'desc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-credits',
					'template-printable' => 'children-credits-printable',
					'query' => "SELECT `credits`.`id` as 'id', IF(    CHAR_LENGTH(`conventions1`.`nom`), CONCAT_WS('',   `conventions1`.`nom`), '') as 'convention', IF(    CHAR_LENGTH(`types_ligne1`.`gestionnaire`) || CHAR_LENGTH(`types_ligne1`.`type`), CONCAT_WS('',   `types_ligne1`.`gestionnaire`, ' - ', `types_ligne1`.`type`), '') as 'ligne_budgetaire', IF(    CHAR_LENGTH(`lignes_credits1`.`intitule`), CONCAT_WS('',   `lignes_credits1`.`intitule`), '') as 'ligne_credit', if(`credits`.`date`,date_format(`credits`.`date`,'%d/%m/%Y'),'') as 'date', `credits`.`intitule` as 'intitule', CONCAT('<span style=''color: ', IF(`credits`.`montant` < 0, 'red', 'black'), ';''>', FORMAT(`credits`.`montant`, 2, 'ru_RU'), '</span>') as 'montant', if(CHAR_LENGTH(`credits`.`notes`)>80, concat(left(`credits`.`notes`,80),' ...'), `credits`.`notes`) as 'notes' FROM `credits` LEFT JOIN `conventions` as conventions1 ON `conventions1`.`id`=`credits`.`convention` LEFT JOIN `budgets` as budgets1 ON `budgets1`.`id`=`credits`.`ligne_budgetaire` LEFT JOIN `types_ligne` as types_ligne1 ON `types_ligne1`.`id`=`budgets1`.`type` LEFT JOIN `lignes_credits` as lignes_credits1 ON `lignes_credits1`.`id`=`credits`.`ligne_credit` "
				),
				'ligne_credit' => array(   
					'parent-table' => 'lignes_credits',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'Cr&#233;dits (ouverture) <span class="hidden child-label-credits child-field-caption">(Ligne de cr&#233;dit / CFI)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/051-revenue.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Convention', 2 => 'Ligne Budg&#233;taire', 3 => 'Ligne de cr&#233;dit / CFI', 4 => 'Date', 5 => 'Intitul&#233;', 6 => 'Montant', 7 => 'Notes'),
					'display-field-names' => array(1 => 'convention', 2 => 'ligne_budgetaire', 3 => 'ligne_credit', 4 => 'date', 5 => 'intitule', 6 => 'montant', 7 => 'notes'),
					'sortable-fields' => array(0 => '`credits`.`id`', 1 => '`conventions1`.`nom`', 2 => 3, 3 => '`lignes_credits1`.`intitule`', 4 => '`credits`.`date`', 5 => 6, 6 => '`credits`.`montant`', 7 => 8),
					'records-per-page' => 50,
					'default-sort-by' => 4,
					'default-sort-direction' => 'desc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-credits',
					'template-printable' => 'children-credits-printable',
					'query' => "SELECT `credits`.`id` as 'id', IF(    CHAR_LENGTH(`conventions1`.`nom`), CONCAT_WS('',   `conventions1`.`nom`), '') as 'convention', IF(    CHAR_LENGTH(`types_ligne1`.`gestionnaire`) || CHAR_LENGTH(`types_ligne1`.`type`), CONCAT_WS('',   `types_ligne1`.`gestionnaire`, ' - ', `types_ligne1`.`type`), '') as 'ligne_budgetaire', IF(    CHAR_LENGTH(`lignes_credits1`.`intitule`), CONCAT_WS('',   `lignes_credits1`.`intitule`), '') as 'ligne_credit', if(`credits`.`date`,date_format(`credits`.`date`,'%d/%m/%Y'),'') as 'date', `credits`.`intitule` as 'intitule', CONCAT('<span style=''color: ', IF(`credits`.`montant` < 0, 'red', 'black'), ';''>', FORMAT(`credits`.`montant`, 2, 'ru_RU'), '</span>') as 'montant', if(CHAR_LENGTH(`credits`.`notes`)>80, concat(left(`credits`.`notes`,80),' ...'), `credits`.`notes`) as 'notes' FROM `credits` LEFT JOIN `conventions` as conventions1 ON `conventions1`.`id`=`credits`.`convention` LEFT JOIN `budgets` as budgets1 ON `budgets1`.`id`=`credits`.`ligne_budgetaire` LEFT JOIN `types_ligne` as types_ligne1 ON `types_ligne1`.`id`=`budgets1`.`type` LEFT JOIN `lignes_credits` as lignes_credits1 ON `lignes_credits1`.`id`=`credits`.`ligne_credit` "
				)
			),
			'ventilation' => array(   
				'convention' => array(   
					'parent-table' => 'conventions',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'Ventilation Budg&#233;taire <span class="hidden child-label-ventilation child-field-caption">(Convention)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/024-tasks.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Convention', 2 => 'Intitul&#233;', 3 => 'Notes', 4 => 'Accord&#233;', 5 => 'Reserv&#233;', 6 => 'Liquid&#233;', 7 => 'Utilis&#233;', 8 => 'Reste &#224; Engager', 9 => 'U/A (%)'),
					'display-field-names' => array(1 => 'convention', 2 => 'intitule', 3 => 'notes', 4 => 'accorde', 5 => 'reserve', 6 => 'liquide', 7 => 'utilise', 8 => 'reste_engager', 9 => 'prop_ua'),
					'sortable-fields' => array(0 => '`ventilation`.`id`', 1 => '`conventions1`.`nom`', 2 => 3, 3 => 4, 4 => '`ventilation`.`accorde`', 5 => '`ventilation`.`reserve`', 6 => '`ventilation`.`liquide`', 7 => '`ventilation`.`utilise`', 8 => '`ventilation`.`reste_engager`', 9 => '`ventilation`.`prop_ua`'),
					'records-per-page' => 50,
					'default-sort-by' => 1,
					'default-sort-direction' => 'asc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-ventilation',
					'template-printable' => 'children-ventilation-printable',
					'query' => "SELECT `ventilation`.`id` as 'id', IF(    CHAR_LENGTH(`conventions1`.`nom`), CONCAT_WS('',   `conventions1`.`nom`), '') as 'convention', `ventilation`.`intitule` as 'intitule', if(CHAR_LENGTH(`ventilation`.`notes`)>80, concat(left(`ventilation`.`notes`,80),' ...'), `ventilation`.`notes`) as 'notes', CONCAT('<span style=''color: ', IF(`ventilation`.`accorde` < 0, 'red', 'black'), ';''>', FORMAT(`ventilation`.`accorde`, 2, 'ru_RU'), '</span>') as 'accorde', CONCAT('<span style=''color: ', IF(`ventilation`.`reserve` < 0, 'red', 'black'), ';''>', FORMAT(`ventilation`.`reserve`, 2, 'ru_RU'), '</span>') as 'reserve', CONCAT('<span style=''color: ', IF(`ventilation`.`liquide` < 0, 'red', 'black'), ';''>', FORMAT(`ventilation`.`liquide`, 2, 'ru_RU'), '</span>') as 'liquide', CONCAT('<span style=''color: ', IF(`ventilation`.`utilise` < 0, 'red', 'black'), ';''>', FORMAT(`ventilation`.`utilise`, 2, 'ru_RU'), '</span>') as 'utilise', CONCAT('<span style=''color: ', IF(`ventilation`.`reste_engager` < 0, 'red', 'black'), ';''>', FORMAT(`ventilation`.`reste_engager`, 2, 'ru_RU'), '</span>') as 'reste_engager', CONCAT('<span style=''color: ', IF(`ventilation`.`prop_ua` > 100, 'red', 'black'), ';''>', FORMAT(`ventilation`.`prop_ua`, 0, 'ru_RU'), '%</span>') as 'prop_ua' FROM `ventilation` LEFT JOIN `conventions` as conventions1 ON `conventions1`.`id`=`ventilation`.`convention` "
				)
			),
			'depenses' => array(   
				'convention' => array(   
					'parent-table' => 'conventions',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'D&#233;penses <span class="hidden child-label-depenses child-field-caption">(Convention)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/005-expenses.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Convention', 2 => 'Ligne Budg&#233;taire', 3 => 'Ligne de cr&#233;dit / CFI', 4 => 'Date', 5 => 'Intitul&#233;', 6 => 'B&#233;n&#233;ficiaire', 7 => 'Montant', 8 => 'Statut', 9 => 'Ventilation Budg&#233;taire', 10 => 'Notes'),
					'display-field-names' => array(1 => 'convention', 2 => 'ligne_budgetaire', 3 => 'ligne_credit', 4 => 'date', 5 => 'intitule', 6 => 'beneficiaire', 7 => 'montant', 8 => 'statut', 9 => 'ventilation', 10 => 'notes'),
					'sortable-fields' => array(0 => '`depenses`.`id`', 1 => '`conventions1`.`nom`', 2 => 3, 3 => '`lignes_credits1`.`intitule`', 4 => '`depenses`.`date`', 5 => 6, 6 => '`personnes1`.`nom`', 7 => '`depenses`.`montant`', 8 => 9, 9 => '`ventilation1`.`intitule`', 10 => 11),
					'records-per-page' => 50,
					'default-sort-by' => 4,
					'default-sort-direction' => 'desc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-depenses',
					'template-printable' => 'children-depenses-printable',
					'query' => "SELECT `depenses`.`id` as 'id', IF(    CHAR_LENGTH(`conventions1`.`nom`), CONCAT_WS('',   `conventions1`.`nom`), '') as 'convention', IF(    CHAR_LENGTH(`types_ligne1`.`gestionnaire`) || CHAR_LENGTH(`types_ligne1`.`type`), CONCAT_WS('',   `types_ligne1`.`gestionnaire`, ' - ', `types_ligne1`.`type`), '') as 'ligne_budgetaire', IF(    CHAR_LENGTH(`lignes_credits1`.`intitule`), CONCAT_WS('',   `lignes_credits1`.`intitule`), '') as 'ligne_credit', if(`depenses`.`date`,date_format(`depenses`.`date`,'%d/%m/%Y'),'') as 'date', `depenses`.`intitule` as 'intitule', IF(    CHAR_LENGTH(`personnes1`.`nom`), CONCAT_WS('',   `personnes1`.`nom`), '') as 'beneficiaire', CONCAT('<span style=''color: ', IF(`depenses`.`montant` < 0, 'red', 'black'), ';''>', FORMAT(`depenses`.`montant`, 2, 'ru_RU'), '</span>') as 'montant', `depenses`.`statut` as 'statut', IF(    CHAR_LENGTH(`ventilation1`.`intitule`), CONCAT_WS('',   `ventilation1`.`intitule`), '') as 'ventilation', if(CHAR_LENGTH(`depenses`.`notes`)>80, concat(left(`depenses`.`notes`,80),' ...'), `depenses`.`notes`) as 'notes' FROM `depenses` LEFT JOIN `conventions` as conventions1 ON `conventions1`.`id`=`depenses`.`convention` LEFT JOIN `budgets` as budgets1 ON `budgets1`.`id`=`depenses`.`ligne_budgetaire` LEFT JOIN `types_ligne` as types_ligne1 ON `types_ligne1`.`id`=`budgets1`.`type` LEFT JOIN `lignes_credits` as lignes_credits1 ON `lignes_credits1`.`id`=`depenses`.`ligne_credit` LEFT JOIN `personnes` as personnes1 ON `personnes1`.`id`=`depenses`.`beneficiaire` LEFT JOIN `ventilation` as ventilation1 ON `ventilation1`.`id`=`depenses`.`ventilation` "
				),
				'ligne_budgetaire' => array(   
					'parent-table' => 'budgets',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'D&#233;penses <span class="hidden child-label-depenses child-field-caption">(Ligne Budg&#233;taire)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/005-expenses.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Convention', 2 => 'Ligne Budg&#233;taire', 3 => 'Ligne de cr&#233;dit / CFI', 4 => 'Date', 5 => 'Intitul&#233;', 6 => 'B&#233;n&#233;ficiaire', 7 => 'Montant', 8 => 'Statut', 9 => 'Ventilation Budg&#233;taire', 10 => 'Notes'),
					'display-field-names' => array(1 => 'convention', 2 => 'ligne_budgetaire', 3 => 'ligne_credit', 4 => 'date', 5 => 'intitule', 6 => 'beneficiaire', 7 => 'montant', 8 => 'statut', 9 => 'ventilation', 10 => 'notes'),
					'sortable-fields' => array(0 => '`depenses`.`id`', 1 => '`conventions1`.`nom`', 2 => 3, 3 => '`lignes_credits1`.`intitule`', 4 => '`depenses`.`date`', 5 => 6, 6 => '`personnes1`.`nom`', 7 => '`depenses`.`montant`', 8 => 9, 9 => '`ventilation1`.`intitule`', 10 => 11),
					'records-per-page' => 50,
					'default-sort-by' => 4,
					'default-sort-direction' => 'desc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-depenses',
					'template-printable' => 'children-depenses-printable',
					'query' => "SELECT `depenses`.`id` as 'id', IF(    CHAR_LENGTH(`conventions1`.`nom`), CONCAT_WS('',   `conventions1`.`nom`), '') as 'convention', IF(    CHAR_LENGTH(`types_ligne1`.`gestionnaire`) || CHAR_LENGTH(`types_ligne1`.`type`), CONCAT_WS('',   `types_ligne1`.`gestionnaire`, ' - ', `types_ligne1`.`type`), '') as 'ligne_budgetaire', IF(    CHAR_LENGTH(`lignes_credits1`.`intitule`), CONCAT_WS('',   `lignes_credits1`.`intitule`), '') as 'ligne_credit', if(`depenses`.`date`,date_format(`depenses`.`date`,'%d/%m/%Y'),'') as 'date', `depenses`.`intitule` as 'intitule', IF(    CHAR_LENGTH(`personnes1`.`nom`), CONCAT_WS('',   `personnes1`.`nom`), '') as 'beneficiaire', CONCAT('<span style=''color: ', IF(`depenses`.`montant` < 0, 'red', 'black'), ';''>', FORMAT(`depenses`.`montant`, 2, 'ru_RU'), '</span>') as 'montant', `depenses`.`statut` as 'statut', IF(    CHAR_LENGTH(`ventilation1`.`intitule`), CONCAT_WS('',   `ventilation1`.`intitule`), '') as 'ventilation', if(CHAR_LENGTH(`depenses`.`notes`)>80, concat(left(`depenses`.`notes`,80),' ...'), `depenses`.`notes`) as 'notes' FROM `depenses` LEFT JOIN `conventions` as conventions1 ON `conventions1`.`id`=`depenses`.`convention` LEFT JOIN `budgets` as budgets1 ON `budgets1`.`id`=`depenses`.`ligne_budgetaire` LEFT JOIN `types_ligne` as types_ligne1 ON `types_ligne1`.`id`=`budgets1`.`type` LEFT JOIN `lignes_credits` as lignes_credits1 ON `lignes_credits1`.`id`=`depenses`.`ligne_credit` LEFT JOIN `personnes` as personnes1 ON `personnes1`.`id`=`depenses`.`beneficiaire` LEFT JOIN `ventilation` as ventilation1 ON `ventilation1`.`id`=`depenses`.`ventilation` "
				),
				'beneficiaire' => array(   
					'parent-table' => 'personnes',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'D&#233;penses <span class="hidden child-label-depenses child-field-caption">(B&#233;n&#233;ficiaire)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/005-expenses.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Convention', 2 => 'Ligne Budg&#233;taire', 3 => 'Ligne de cr&#233;dit / CFI', 4 => 'Date', 5 => 'Intitul&#233;', 6 => 'B&#233;n&#233;ficiaire', 7 => 'Montant', 8 => 'Statut', 9 => 'Ventilation Budg&#233;taire', 10 => 'Notes'),
					'display-field-names' => array(1 => 'convention', 2 => 'ligne_budgetaire', 3 => 'ligne_credit', 4 => 'date', 5 => 'intitule', 6 => 'beneficiaire', 7 => 'montant', 8 => 'statut', 9 => 'ventilation', 10 => 'notes'),
					'sortable-fields' => array(0 => '`depenses`.`id`', 1 => '`conventions1`.`nom`', 2 => 3, 3 => '`lignes_credits1`.`intitule`', 4 => '`depenses`.`date`', 5 => 6, 6 => '`personnes1`.`nom`', 7 => '`depenses`.`montant`', 8 => 9, 9 => '`ventilation1`.`intitule`', 10 => 11),
					'records-per-page' => 50,
					'default-sort-by' => 4,
					'default-sort-direction' => 'desc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-depenses',
					'template-printable' => 'children-depenses-printable',
					'query' => "SELECT `depenses`.`id` as 'id', IF(    CHAR_LENGTH(`conventions1`.`nom`), CONCAT_WS('',   `conventions1`.`nom`), '') as 'convention', IF(    CHAR_LENGTH(`types_ligne1`.`gestionnaire`) || CHAR_LENGTH(`types_ligne1`.`type`), CONCAT_WS('',   `types_ligne1`.`gestionnaire`, ' - ', `types_ligne1`.`type`), '') as 'ligne_budgetaire', IF(    CHAR_LENGTH(`lignes_credits1`.`intitule`), CONCAT_WS('',   `lignes_credits1`.`intitule`), '') as 'ligne_credit', if(`depenses`.`date`,date_format(`depenses`.`date`,'%d/%m/%Y'),'') as 'date', `depenses`.`intitule` as 'intitule', IF(    CHAR_LENGTH(`personnes1`.`nom`), CONCAT_WS('',   `personnes1`.`nom`), '') as 'beneficiaire', CONCAT('<span style=''color: ', IF(`depenses`.`montant` < 0, 'red', 'black'), ';''>', FORMAT(`depenses`.`montant`, 2, 'ru_RU'), '</span>') as 'montant', `depenses`.`statut` as 'statut', IF(    CHAR_LENGTH(`ventilation1`.`intitule`), CONCAT_WS('',   `ventilation1`.`intitule`), '') as 'ventilation', if(CHAR_LENGTH(`depenses`.`notes`)>80, concat(left(`depenses`.`notes`,80),' ...'), `depenses`.`notes`) as 'notes' FROM `depenses` LEFT JOIN `conventions` as conventions1 ON `conventions1`.`id`=`depenses`.`convention` LEFT JOIN `budgets` as budgets1 ON `budgets1`.`id`=`depenses`.`ligne_budgetaire` LEFT JOIN `types_ligne` as types_ligne1 ON `types_ligne1`.`id`=`budgets1`.`type` LEFT JOIN `lignes_credits` as lignes_credits1 ON `lignes_credits1`.`id`=`depenses`.`ligne_credit` LEFT JOIN `personnes` as personnes1 ON `personnes1`.`id`=`depenses`.`beneficiaire` LEFT JOIN `ventilation` as ventilation1 ON `ventilation1`.`id`=`depenses`.`ventilation` "
				),
				'ventilation' => array(   
					'parent-table' => 'ventilation',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'D&#233;penses <span class="hidden child-label-depenses child-field-caption">(Ventilation Budg&#233;taire)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/005-expenses.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Convention', 2 => 'Ligne Budg&#233;taire', 3 => 'Ligne de cr&#233;dit / CFI', 4 => 'Date', 5 => 'Intitul&#233;', 6 => 'B&#233;n&#233;ficiaire', 7 => 'Montant', 8 => 'Statut', 9 => 'Ventilation Budg&#233;taire', 10 => 'Notes'),
					'display-field-names' => array(1 => 'convention', 2 => 'ligne_budgetaire', 3 => 'ligne_credit', 4 => 'date', 5 => 'intitule', 6 => 'beneficiaire', 7 => 'montant', 8 => 'statut', 9 => 'ventilation', 10 => 'notes'),
					'sortable-fields' => array(0 => '`depenses`.`id`', 1 => '`conventions1`.`nom`', 2 => 3, 3 => '`lignes_credits1`.`intitule`', 4 => '`depenses`.`date`', 5 => 6, 6 => '`personnes1`.`nom`', 7 => '`depenses`.`montant`', 8 => 9, 9 => '`ventilation1`.`intitule`', 10 => 11),
					'records-per-page' => 50,
					'default-sort-by' => 4,
					'default-sort-direction' => 'desc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-depenses',
					'template-printable' => 'children-depenses-printable',
					'query' => "SELECT `depenses`.`id` as 'id', IF(    CHAR_LENGTH(`conventions1`.`nom`), CONCAT_WS('',   `conventions1`.`nom`), '') as 'convention', IF(    CHAR_LENGTH(`types_ligne1`.`gestionnaire`) || CHAR_LENGTH(`types_ligne1`.`type`), CONCAT_WS('',   `types_ligne1`.`gestionnaire`, ' - ', `types_ligne1`.`type`), '') as 'ligne_budgetaire', IF(    CHAR_LENGTH(`lignes_credits1`.`intitule`), CONCAT_WS('',   `lignes_credits1`.`intitule`), '') as 'ligne_credit', if(`depenses`.`date`,date_format(`depenses`.`date`,'%d/%m/%Y'),'') as 'date', `depenses`.`intitule` as 'intitule', IF(    CHAR_LENGTH(`personnes1`.`nom`), CONCAT_WS('',   `personnes1`.`nom`), '') as 'beneficiaire', CONCAT('<span style=''color: ', IF(`depenses`.`montant` < 0, 'red', 'black'), ';''>', FORMAT(`depenses`.`montant`, 2, 'ru_RU'), '</span>') as 'montant', `depenses`.`statut` as 'statut', IF(    CHAR_LENGTH(`ventilation1`.`intitule`), CONCAT_WS('',   `ventilation1`.`intitule`), '') as 'ventilation', if(CHAR_LENGTH(`depenses`.`notes`)>80, concat(left(`depenses`.`notes`,80),' ...'), `depenses`.`notes`) as 'notes' FROM `depenses` LEFT JOIN `conventions` as conventions1 ON `conventions1`.`id`=`depenses`.`convention` LEFT JOIN `budgets` as budgets1 ON `budgets1`.`id`=`depenses`.`ligne_budgetaire` LEFT JOIN `types_ligne` as types_ligne1 ON `types_ligne1`.`id`=`budgets1`.`type` LEFT JOIN `lignes_credits` as lignes_credits1 ON `lignes_credits1`.`id`=`depenses`.`ligne_credit` LEFT JOIN `personnes` as personnes1 ON `personnes1`.`id`=`depenses`.`beneficiaire` LEFT JOIN `ventilation` as ventilation1 ON `ventilation1`.`id`=`depenses`.`ventilation` "
				)
			),
			'fichiers' => array(   
				'convention' => array(   
					'parent-table' => 'conventions',
					'parent-primary-key' => 'id',
					'child-primary-key' => 'id',
					'child-primary-key-index' => 0,
					'tab-label' => 'Fichiers <span class="hidden child-label-fichiers child-field-caption">(Convention)</span>',
					'auto-close' => true,
					'table-icon' => 'resources/table_icons/025-exchange.png',
					'display-refresh' => true,
					'display-add-new' => true,
					'forced-where' => '',
					'display-fields' => array(1 => 'Convention', 2 => 'Titre', 3 => 'Fichier', 4 => 'Notes'),
					'display-field-names' => array(1 => 'convention', 2 => 'titre', 3 => 'fichier', 4 => 'notes'),
					'sortable-fields' => array(0 => '`fichiers`.`id`', 1 => '`conventions1`.`nom`', 2 => 3, 3 => 4, 4 => 5),
					'records-per-page' => 50,
					'default-sort-by' => 2,
					'default-sort-direction' => 'asc',
					'open-detail-view-on-click' => true,
					'display-page-selector' => true,
					'show-page-progress' => true,
					'template' => 'children-fichiers',
					'template-printable' => 'children-fichiers-printable',
					'query' => "SELECT `fichiers`.`id` as 'id', IF(    CHAR_LENGTH(`conventions1`.`nom`), CONCAT_WS('',   `conventions1`.`nom`), '') as 'convention', `fichiers`.`titre` as 'titre', `fichiers`.`fichier` as 'fichier', if(CHAR_LENGTH(`fichiers`.`notes`)>80, concat(left(`fichiers`.`notes`,80),' ...'), `fichiers`.`notes`) as 'notes' FROM `fichiers` LEFT JOIN `conventions` as conventions1 ON `conventions1`.`id`=`fichiers`.`convention` "
				)
			),
			'personnes' => array(   
			),
			'types_ligne' => array(   
			)
		);

	/*************************************/
	/* End of configuration */


	$currDir = dirname(__FILE__);
	include("{$currDir}/defaultLang.php");
	include("{$currDir}/language.php");
	include("{$currDir}/lib.php");
	@header('Content-Type: text/html; charset=' . datalist_db_encoding);

	handle_maintenance();

	/**
	* dynamic configuration based on current user's permissions
	* $userPCConfig array is populated only with parent tables where the user has access to
	* at least one child table
	*/
	$userPCConfig = array();
	foreach($pcConfig as $pcChildTable => $ChildrenLookups){
		$permChild = getTablePermissions($pcChildTable);
		if($permChild[2]){ // user can view records of the child table, so proceed to check children lookups
			foreach($ChildrenLookups as $ChildLookupField => $ChildConfig){
				$permParent = getTablePermissions($ChildConfig['parent-table']);
				if($permParent[2]){ // user can view records of parent table
					$userPCConfig[$pcChildTable][$ChildLookupField] = $pcConfig[$pcChildTable][$ChildLookupField];
					// show add new only if configured above AND the user has insert permission
					if($permChild[1] && $pcConfig[$pcChildTable][$ChildLookupField]['display-add-new']){
						$userPCConfig[$pcChildTable][$ChildLookupField]['display-add-new'] = true;
					}else{
						$userPCConfig[$pcChildTable][$ChildLookupField]['display-add-new'] = false;
					}
				}
			}
		}
	}

	/* Receive, UTF-convert, and validate parameters */
	$ParentTable = $_REQUEST['ParentTable']; // needed only with operation=show-children, will be validated in the processing code
	$ChildTable = $_REQUEST['ChildTable'];
		if(!in_array($ChildTable, array_keys($userPCConfig))){
			/* defaults to first child table in config array if not provided */
			$ChildTable = current(array_keys($userPCConfig));
		}
		if(!$ChildTable){ die('<!-- No tables accessible to current user -->'); }
	$SelectedID = strip_tags($_REQUEST['SelectedID']);
	$ChildLookupField = $_REQUEST['ChildLookupField'];
		if(!in_array($ChildLookupField, array_keys($userPCConfig[$ChildTable]))){
			/* defaults to first lookup in current child config array if not provided */
			$ChildLookupField = current(array_keys($userPCConfig[$ChildTable]));
		}
	$Page = intval($_REQUEST['Page']);
		if($Page < 1){
			$Page = 1;
		}
	$SortBy = ($_REQUEST['SortBy'] != '' ? abs(intval($_REQUEST['SortBy'])) : false);
		if(!in_array($SortBy, array_keys($userPCConfig[$ChildTable][$ChildLookupField]['sortable-fields']), true)){
			$SortBy = $userPCConfig[$ChildTable][$ChildLookupField]['default-sort-by'];
		}
	$SortDirection = strtolower($_REQUEST['SortDirection']);
		if(!in_array($SortDirection, array('asc', 'desc'))){
			$SortDirection = $userPCConfig[$ChildTable][$ChildLookupField]['default-sort-direction'];
		}
	$Operation = strtolower($_REQUEST['Operation']);
		if(!in_array($Operation, array('get-records', 'show-children', 'get-records-printable', 'show-children-printable'))){
			$Operation = 'get-records';
		}

	/* process requested operation */
	switch($Operation){
		/************************************************/
		case 'show-children':
			/* populate HTML and JS content with children tabs */
			$tabLabels = $tabPanels = $tabLoaders = '';
			foreach($userPCConfig as $ChildTable => $childLookups){
				foreach($childLookups as $ChildLookupField => $childConfig){
					if($childConfig['parent-table'] == $ParentTable){
						$TableIcon = ($childConfig['table-icon'] ? "<img src=\"{$childConfig['table-icon']}\" border=\"0\" />" : '');
						$tabLabels .= sprintf('<li%s><a href="#panel_%s-%s" id="tab_%s-%s" data-toggle="tab">%s%s</a></li>' . "\n\t\t\t\t\t",($tabLabels ? '' : ' class="active"'), $ChildTable, $ChildLookupField, $ChildTable, $ChildLookupField, $TableIcon, $childConfig['tab-label']);
						$tabPanels .= sprintf('<div id="panel_%s-%s" class="tab-pane%s"><img src="loading.gif" align="top" />%s</div>' . "\n\t\t\t\t", $ChildTable, $ChildLookupField, ($tabPanels ? '' : ' active'), $Translation['Loading ...']);
						$tabLoaders .= sprintf('post("parent-children.php", { ChildTable: "%s", ChildLookupField: "%s", SelectedID: "%s", Page: 1, SortBy: "", SortDirection: "", Operation: "get-records" }, "panel_%s-%s");' . "\n\t\t\t\t", $ChildTable, $ChildLookupField, addslashes($SelectedID), $ChildTable, $ChildLookupField);
					}
				}
			}

			if(!$tabLabels){ die('<!-- no children of current parent table are accessible to current user -->'); }
			?>
			<div id="children-tabs">
				<ul class="nav nav-tabs">
					<?php echo $tabLabels; ?>
				</ul>
				<span id="pc-loading"></span>
			</div>
			<div class="tab-content"><?php echo $tabPanels; ?></div>

			<script>
				$j(function(){
					/* for iOS, avoid loading child tabs in modals */
					var iOS = /(iPad|iPhone|iPod)/g.test(navigator.userAgent);
					var embedded = ($j('.navbar').length == 0);
					if(iOS && embedded){
						$j('#children-tabs').next('.tab-content').remove();
						$j('#children-tabs').remove();
						return;
					}

					/* ajax loading of each tab's contents */
					<?php echo $tabLoaders; ?>

					/* show child field caption on tab title in case the same child table appears more than once */
					$j('.child-field-caption').each(function() {
						var clss = $j(this).attr('class').split(/\s+/).reduce(function(rc, cc) {
							return (cc.match(/child-label-.*/) ? '.' + cc : rc);
						}, '');

						// if class occurs more than once, remove .hidden
						if($j(clss).length > 1) $j(clss).removeClass('hidden');
					})
				})
			</script>
			<?php
			break;

		/************************************************/
		case 'show-children-printable':
			/* populate HTML and JS content with children buttons */
			$tabLabels = $tabPanels = $tabLoaders = '';
			foreach($userPCConfig as $ChildTable => $childLookups){
				foreach($childLookups as $ChildLookupField => $childConfig){
					if($childConfig['parent-table'] == $ParentTable){
						$TableIcon = ($childConfig['table-icon'] ? "<img src=\"{$childConfig['table-icon']}\" border=\"0\" />" : '');
						$tabLabels .= sprintf('<button type="button" class="btn btn-default" data-target="#panel_%s-%s" id="tab_%s-%s" data-toggle="collapse">%s %s</button>' . "\n\t\t\t\t\t", $ChildTable, $ChildLookupField, $ChildTable, $ChildLookupField, $TableIcon, $childConfig['tab-label']);
						$tabPanels .= sprintf('<div id="panel_%s-%s" class="collapse"><img src="loading.gif" align="top" />%s</div>' . "\n\t\t\t\t", $ChildTable, $ChildLookupField, $Translation['Loading ...']);
						$tabLoaders .= sprintf('post("parent-children.php", { ChildTable: "%s", ChildLookupField: "%s", SelectedID: "%s", Page: 1, SortBy: "", SortDirection: "", Operation: "get-records-printable" }, "panel_%s-%s");' . "\n\t\t\t\t", $ChildTable, $ChildLookupField, addslashes($SelectedID), $ChildTable, $ChildLookupField);
					}
				}
			}

			if(!$tabLabels){ die('<!-- no children of current parent table are accessible to current user -->'); }
			?>
			<div id="children-tabs" class="hidden-print">
				<div class="btn-group btn-group-lg">
					<?php echo $tabLabels; ?>
				</div>
				<span id="pc-loading"></span>
			</div>
			<div class="vspacer-lg"><?php echo $tabPanels; ?></div>

			<script>
				$j(function(){
					/* for iOS, avoid loading child tabs in modals */
					var iOS = /(iPad|iPhone|iPod)/g.test(navigator.userAgent);
					var embedded = ($j('.navbar').length == 0);
					if(iOS && embedded){
						$j('#children-tabs').next('.tab-content').remove();
						$j('#children-tabs').remove();
						return;
					}

					/* ajax loading of each tab's contents */
					<?php echo $tabLoaders; ?>
				})
			</script>
			<?php
			break;

		/************************************************/
		case 'get-records-printable':
		default: /* default is 'get-records' */

			if($Operation == 'get-records-printable'){
				$userPCConfig[$ChildTable][$ChildLookupField]['records-per-page'] = 2000;
			}

			// build the user permissions limiter
			$permissionsWhere = $permissionsJoin = '';
			$permChild = getTablePermissions($ChildTable);
			if($permChild[2] == 1){ // user can view only his own records
				$permissionsWhere = "`$ChildTable`.`{$userPCConfig[$ChildTable][$ChildLookupField]['child-primary-key']}`=`membership_userrecords`.`pkValue` AND `membership_userrecords`.`tableName`='$ChildTable' AND LCASE(`membership_userrecords`.`memberID`)='".getLoggedMemberID()."'";
			}elseif($permChild[2] == 2){ // user can view only his group's records
				$permissionsWhere = "`$ChildTable`.`{$userPCConfig[$ChildTable][$ChildLookupField]['child-primary-key']}`=`membership_userrecords`.`pkValue` AND `membership_userrecords`.`tableName`='$ChildTable' AND `membership_userrecords`.`groupID`='".getLoggedGroupID()."'";
			}elseif($permChild[2] == 3){ // user can view all records
				/* that's the only case remaining ... no need to modify the query in this case */
			}
			$permissionsJoin = ($permissionsWhere ? ", `membership_userrecords`" : '');

			// build the count query
			$forcedWhere = $userPCConfig[$ChildTable][$ChildLookupField]['forced-where'];
			$query = 
				preg_replace('/^select .* from /i', 'SELECT count(1) FROM ', $userPCConfig[$ChildTable][$ChildLookupField]['query']) .
				$permissionsJoin . " WHERE " .
				($permissionsWhere ? "( $permissionsWhere )" : "( 1=1 )") . " AND " .
				($forcedWhere ? "( $forcedWhere )" : "( 2=2 )") . " AND " .
				"`$ChildTable`.`$ChildLookupField`='" . makeSafe($SelectedID) . "'";
			$totalMatches = sqlValue($query);

			// make sure $Page is <= max pages
			$maxPage = ceil($totalMatches / $userPCConfig[$ChildTable][$ChildLookupField]['records-per-page']);
			if($Page > $maxPage){ $Page = $maxPage; }

			// initiate output data array
			$data = array(
				'config' => $userPCConfig[$ChildTable][$ChildLookupField],
				'parameters' => array(
					'ChildTable' => $ChildTable,
					'ChildLookupField' => $ChildLookupField,
					'SelectedID' => $SelectedID,
					'Page' => $Page,
					'SortBy' => $SortBy,
					'SortDirection' => $SortDirection,
					'Operation' => $Operation
				),
				'records' => array(),
				'totalMatches' => $totalMatches
			);

			// build the data query
			if($totalMatches){ // if we have at least one record, proceed with fetching data
				$startRecord = $userPCConfig[$ChildTable][$ChildLookupField]['records-per-page'] * ($Page - 1);
				$data['query'] = 
					$userPCConfig[$ChildTable][$ChildLookupField]['query'] .
					$permissionsJoin . " WHERE " .
					($permissionsWhere ? "( $permissionsWhere )" : "( 1=1 )") . " AND " .
					($forcedWhere ? "( $forcedWhere )" : "( 2=2 )") . " AND " .
					"`$ChildTable`.`$ChildLookupField`='" . makeSafe($SelectedID) . "'" . 
					($SortBy !== false && $userPCConfig[$ChildTable][$ChildLookupField]['sortable-fields'][$SortBy] ? " ORDER BY {$userPCConfig[$ChildTable][$ChildLookupField]['sortable-fields'][$SortBy]} $SortDirection" : '') .
					" LIMIT $startRecord, {$userPCConfig[$ChildTable][$ChildLookupField]['records-per-page']}";
				$res = sql($data['query'], $eo);
				while($row = db_fetch_row($res)){
					$data['records'][$row[$userPCConfig[$ChildTable][$ChildLookupField]['child-primary-key-index']]] = $row;
				}
			}else{ // if no matching records
				$startRecord = 0;
			}

			if($Operation == 'get-records-printable'){
				$response = loadView($userPCConfig[$ChildTable][$ChildLookupField]['template-printable'], $data);
			}else{
				$response = loadView($userPCConfig[$ChildTable][$ChildLookupField]['template'], $data);
			}

			// change name space to ensure uniqueness
			$uniqueNameSpace = $ChildTable.ucfirst($ChildLookupField).'GetRecords';
			echo str_replace("{$ChildTable}GetChildrenRecordsList", $uniqueNameSpace, $response);
		/************************************************/
	}
